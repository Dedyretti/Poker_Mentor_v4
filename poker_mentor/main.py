import os
import logging
import asyncio
from dotenv import load_dotenv

# –ó–∞–≥—Ä—É–∑–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
load_dotenv()

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
)
logger = logging.getLogger(__name__)

async def main():
    """–ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"""
    try:
        logger.info("üöÄ Starting Poker Mentor application...")
        
        # 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
        from app.database.database import init_db
        init_db()
        logger.info("‚úÖ Database initialized")
        
        # 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è AI –∫–ª–∏–µ–Ω—Ç–∞
        from app.ai.ai_client import AIClient
        ai_client = AIClient()
        logger.info("‚úÖ AI client initialized")
        
        # 3. –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞
        from app.bot.bot_core import start_bot
        from poker_mentor.config import settings

        bot_token = settings.TELEGRAM_BOT_TOKEN
        
        if not bot_token:
            logger.error("‚ùå BOT_TOKEN not found in environment variables")
            return
        
        logger.info("‚úÖ Starting Telegram bot...")
        await start_bot(bot_token)
        
    except Exception as e:
        logger.error(f"‚ùå Application failed to start: {e}")
        raise

if __name__ == "__main__":
    # –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞ –¥–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É –ø–æ—Ä—Ç–∞
    port = int(os.environ.get("PORT", 8000))
    logger.info(f"üöÄ Application starting on port {port}")
    asyncio.run(main())